<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/Blog/assets/index.css">
    <style>
        body {
            padding: 40px;
        }
    </style>
</head>
<body>
    Fetching...
    <script>
        const BlogBooks = {
            posts() {
                fetch("https://blogbooks-fetcher-1.haru070.repl.co/posts")
                    .then(response => response.json())
                    .then(query => {
                        var $content;
                        query.forEach(data => {
                            if (data.excerpt.protected == "true") {} else {
                                $content += `<div class="post" data-postID="${data.id}"><div class="title">${data.title.rendered}</div><div class="description">${data.excerpt.rendered}</div></div>`;
                            }
                        });
                        document.body.innerHTML = $content;
                    })
                    .catch(e => {
                        document.body.innerHTML = e;
                        console.error(e);
                    })
            },
            page(id = "") {
                if (id === (null || "" || undefined)) return;
                fetch(`https://blogbooks-fetcher-1.haru070.repl.co/page/?id=${id}`)
                    .then(response => response.json())
                    .then(query => {
                        $content = `<h1>${query.title.rendered}</h1><div class="date">Date: ${query.date}</div><div class="content">${query.content.rendered}</div>`;
                        document.body.innerHTML = $content;
                    })
                    .catch(e => {
                        document.body.innerHTML = e;
                        console.error(e);
                    })
            }
        }

        function getParam(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        // Start Line
        if (location.pathname.startsWith("/Blog")) {
            var target = location.href.split("/");
            const checkNaN = Number.isNaN || isNaN;
            if (checkNaN(target[target.length]) && checkNaN(target[target.length - 1])) {
                BlogBooks.posts();
            } else {
                checkNaN(target[target.length]) ? BlogBooks.page(target[target.length -1]) : BlogBooks.page(target[target.length]);
            }
        } else {
            location.href = location.origin;
        }
    </script>
</body>
</html>